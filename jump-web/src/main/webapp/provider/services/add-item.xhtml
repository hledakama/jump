<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="en"
xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://xmlns.jcp.org/jsf/html"
xmlns:f="http://xmlns.jcp.org/jsf/core"
xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
 <f:metadata>
   <f:viewParam name="kind"      value="#{addItem.service.kind}"/>
   <f:viewParam name="type"      value="#{addItem.service.type}"/>
   <f:viewParam name="service"   value="#{addItem.service.servicename}"/> 
   <f:viewParam name="category"  value="#{addItem.service.category}"/>  
   <f:event type="preRenderView" listener="#{addItem.loadService}"/>
 </f:metadata>
    
    <ui:composition template="/WEB-INF/masterTemplate.xhtml">        
        <!--
            https://stackoverflow.com/questions/8367421/how-to-reference-css-js-image-resource-in-facelets-template
        
            
        -->
        <ui:define name="title"> 
            <h:outputStylesheet name="css/datatable_styles.css" />
            <h:outputText value="#{addItem.pageTitle}"/> 
        </ui:define> 
        

        <ui:define name="location"> 
            <h:outputText value="#{addItem.nav1}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.nav2}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.nav3}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.nav4}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.service.servicename}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.service.category}"/><h:graphicImage value="#{resource['images/common/nav_arrow.png']}" alt="/"/>
            <h:outputText value="#{addItem.nav5}"/>
        </ui:define>
        
        <ui:define name="content">
            <!-- add required content here-->            
            <h:form id="add_item_form_id" enctype="multipart/form-data">
                <h:messages id= "globalMessagesId" infoStyle="color:blue" warnStyle="color:orange" errorStyle="color:red"/>
                <h:panelGrid columns="5">
                    <h:outputLabel value="#{addItem.serviceKind}"/>
                    <h:outputLabel value="#{addItem.serviceType}"/>
                    <h:outputLabel value="#{addItem.serviceReference}"/>
                    <h:outputLabel value="#{addItem.itemReference}"/>
                    <h:outputLabel value="#{addItem.name}"/>
                    
                    
                    
                    <h:outputText id = "service_kind" value="#{addItem.service.kind}"/>
                    <h:outputText id = "service_type" value="#{addItem.service.type}"/>
                    <h:outputText id = "service_reference" value="#{addItem.service.servicereference}"/>
                    <h:outputText id = "item_reference" value="#{addItem.item.itemreference}"/>                    
                    <!--https://stackoverflow.com/questions/14824178/getting-selected-value-of-a-selectonemenu-->                    
                    <h:selectOneMenu id = "item_name" required="true" value="#{addItem.item.itemname}"
                                     valueChangeListener="#{addItem.onNameChanged}">
                        <f:selectItems value="#{addItem.itemsNames}"/>
                        <f:validateLength minimum="3" maximum="50"/>
                        <f:ajax render="@form"/>
                    </h:selectOneMenu>                    
                    <h:message for="item_name"/>                    
                </h:panelGrid>
                <!-- https://datatables.net/reference/option/
                     https://datatables.net/reference/index
                     https://datatables.net/reference/option/ajax
                     https://www.packtpub.com/books/content/data-tables-and-datatables-plugin-jquery-13-php
                     https://www.sitepoint.com/working-jquery-datatables/
                     https://www.packtpub.com/books/content/calendars-jquery-13-php-using-jquery-week-calendar-plugin-part-1
                     https://www.packtpub.com/books/content/calendars-jquery-13-php-using-jquery-week-calendar-plugin-part-2
                     https://stackoverflow.com/questions/18867599/jquery-inarray-how-to-use-it-right
                     https://avinmathew.com/tag/datatables/
                     https://stackoverflow.com/questions/25211553/datatables-custom-response-handling
                     https://www.sitepoint.com/use-jquerys-ajax-function/
                
                Finally there won't be address editing here. When created, an item data will fetch list of addresses from
                provider account. Later if provider is willing to modify the address per item data, he will do it from his.
                account. i.e. provider address must have at least one address registered before being be able to publish a service.
              
                If address does not exist here, redirect the provider to his account for creation before being back here.
                
                https://stackoverflow.com/questions/3008395/jsf-facelets-sometimes-i-see-the-url-is-jsf-and-sometimes-xhtml-why
                https://stackoverflow.com/questions/19139426/how-to-write-a-file-to-resource-images-folder-of-the-app
                https://stackoverflow.com/questions/14211843/how-to-save-uploaded-file-in-jsf
                
                
                
                -->
            
                
                <h:dataTable id="itemdata_table" value="#{addItem.sortitemdatamodel}" var="model_item_data">
                    <h:column>
                        <f:facet name="header"> #{addItem.date_}  </f:facet> 
                        #{model_item_data.mdate}
                    </h:column>
                    
                    <!--h:column>
                        <f:facet name="header"> #{addItem.avatar}   </f:facet>                         
                        <h:graphicImage id ="existing_model_avatar" value="#{model_item_data.currentAvatar}" alt="avatar is missing will use default" rendered="#{not model_item_data.edited}"/> 
                    </h:column-->
                    
                    <h:column>
                        <f:facet name="header"> #{addItem.avatar}</f:facet>                         
                      <h:graphicImage id="model_file_preview" value="/PreviewServlet/#{header['Content-Length']}" 
                                      alt="avatar is missing will use default" rendered="#{model_item_data.edited}" 
                                      width="#{model_item_data.file.size gt 0 ? 100 : 0}" 
                                      height="#{model_item_data.file.size gt 0 ? 100 : 0}"/>  
                      
                      <h:inputFile id="model_file" required="false" requiredMessage="No file selected ..."
                                   value="#{model_item_data.file}" rendered="#{model_item_data.edited}">                                
                          <f:ajax listener="#{model_item_data.validateFile()}" render="model_file_preview"/> 
                      </h:inputFile>
                                                                    
                    </h:column>
                    
                    <h:column>
                       <f:facet name="header">#{addItem.comment}</f:facet> 
                       <h:outputText value="#{model_item_data.comment}"   rendered="#{not model_item_data.edited}"/>                      
                       <h:inputText value="#{model_item_data.comment}" rendered="#{model_item_data.edited}">
                      </h:inputText>                      
                    </h:column>
                    
                    <h:column>
                        <f:facet name="header">#{addItem.duration}</f:facet>  
                        <h:outputText value="#{model_item_data.duration}"   rendered="#{not model_item_data.edited}"/>
                      
                        <h:inputText value="#{model_item_data.duration}" rendered="#{model_item_data.edited}">
                      </h:inputText>
                    </h:column>
                    
                    <h:column>
                        <f:facet name="header">#{addItem.price}</f:facet>  
                        <h:outputText value="#{model_item_data.price}"   rendered="#{not model_item_data.edited}"/>
                      
                        <h:inputText value="#{model_item_data.price}" rendered="#{model_item_data.edited}">
                      </h:inputText>
                    </h:column>
                    
                    <h:column>
                        <f:facet name="header">#{addItem.qty}</f:facet>  
                        <h:outputText value="#{model_item_data.qty}"   rendered="#{not model_item_data.edited}"/>
                      
                        <h:inputText value="#{model_item_data.qty}" rendered="#{model_item_data.edited}">
                      </h:inputText>
                    </h:column>
                    
                    <h:column>
                        <f:facet name="header">#{addItem.virtual}</f:facet>  
                        <h:outputText value="#{model_item_data.virtual}"   rendered="#{not model_item_data.edited}"/>
                      
                        <h:inputText value="#{model_item_data.virtual}" rendered="#{model_item_data.edited}">
                      </h:inputText>
                    </h:column>
                    
                    <h:column>
                        <f:facet name="header">#{addItem.unit}</f:facet> 
                        <h:outputText value="#{model_item_data.unit}"  rendered="#{not model_item_data.edited}"/>
                      
                        <h:selectOneMenu id = "unit" required="true" value="#{model_item_data.unit}" rendered="#{model_item_data.edited}">
                            <f:selectItems value="#{addItem.unitsList}" />
                        </h:selectOneMenu>
                    </h:column> 
                  
                    <h:column>
                      <f:facet name="header">#{addItem.remove}</f:facet>
                      
                      <h:commandButton image="#{resource['images/common/red_minus.png']}" action="#{addItem.removeRowItemdata(model_item_data)}" /> 
                    </h:column>
                    
                    <h:column>
                      <f:facet name="header">#{addItem.edit}</f:facet>
                      <h:commandButton image="#{resource['images/common/green_plus.png']}" action="#{addItem.editRowItemdata(model_item_data)}" rendered="#{not model_item_data.edited}"> 
                          <f:ajax render="@form"/>
                      </h:commandButton>
                    </h:column>
                </h:dataTable>
                
                <h:panelGrid columns="8">
                    <h:outputLabel value="#{addItem.avatar}"/>
                    <h:outputLabel value="#{addItem.upload}"/>
                    <h:outputLabel value="#{addItem.comment}"/>
                    <h:outputLabel value="#{addItem.duration}"/>
                    <h:outputLabel value="#{addItem.price}"/>
                    <h:outputLabel value="#{addItem.qty}"/>
                    <h:outputLabel value="#{addItem.virtual}"/>
                    <h:outputLabel value="#{addItem.unit}"/>
                    
                    <h:graphicImage id="previewImgId" value="/PreviewServlet/#{header['Content-Length']}" width="#{addItem.itemdata.file.size gt 0 ? 100 : 0}" height="#{addItem.itemdata.file.size gt 0 ? 100 : 0}"/>                    
                    <h:inputFile id="fileToUpload_itemdata" required="false" requiredMessage="No file selected ..." value="#{addItem.itemdata.file}">
                        <f:ajax render="previewImgId" listener="#{addItem.itemdata.validateFile()}"/>           
                    </h:inputFile>
                    <h:inputText id = "comment_itemdata" value="#{addItem.itemdata.comment}"/>   
                    <h:inputText id = "durataion_itemdata" value="#{addItem.itemdata.duration}"/>
                                        
                    <h:inputText id = "itemdata_price" required="true" value="#{addItem.itemdata.price}">
                        <f:validateLongRange minimum="1" maximum="1000000"/>
                    </h:inputText >                    
                    
                    <h:inputText id = "itemdata_qty" required="#{not addItem.virtualItemdata}" value="#{addItem.itemdata.qty}">
                    <f:validateLongRange minimum="0" maximum="10000"/>
                    </h:inputText > 
                    
                    <h:selectBooleanCheckbox id = "itemdata_virtual" value="#{addItem.virtualItemdata}"/>                    
                    
                    <h:selectOneMenu id = "unit_itemdata" required="true" value="#{addItem.itemdata.unit}">
                        <f:selectItems value="#{addItem.unitsList}" />
                    </h:selectOneMenu>                    
                </h:panelGrid>
                 
                 <h:commandButton value="#{addItem.saveItemLabel}" action="#{addItem.saveItem()}">
                     <!-- <f:ajax execute="fileToUpload" render="@all"/> use @all in JSF 2.2.0 -->
                     <f:ajax execute="@form" render="@form"/> <!-- works in JSF 2.2.5 -->
                 </h:commandButton>
            
            </h:form>
            
        </ui:define>
    </ui:composition>
</html>
<!--  
https://www.mkyong.com/jsf2/4-ways-to-pass-parameter-from-jsf-page-to-backing-bean/



-->